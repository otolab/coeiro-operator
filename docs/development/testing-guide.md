# Testing Guide

COEIRO Operatorãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆæ§‹æˆã¨mcp-debugçµ±åˆãƒ†ã‚¹ãƒˆã®ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [`docs/test-quality-guidelines.md`](./test-quality-guidelines.md) - ãƒ†ã‚¹ãƒˆå“è³ªã®åŸºæœ¬åŸå‰‡ã¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [`docs/development-tips.md`](./development-tips.md) - é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹å…¨èˆ¬

## ãƒ†ã‚¹ãƒˆæ§‹æˆ

### ğŸ—ï¸ ãƒ†ã‚¹ãƒˆåˆ†é›¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯2ã¤ã®ç‹¬ç«‹ã—ãŸãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ï¼š

1. **COEIRO Operator Core Tests**: ãƒ¡ã‚¤ãƒ³ã®COEIRO Operatoræ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
2. **MCP Debug Environment Tests**: MCPãƒ‡ãƒãƒƒã‚°ç’°å¢ƒè‡ªä½“ã®ãƒ†ã‚¹ãƒˆ

### ğŸ“ ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ (çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¯¾å¿œ)

```
src/
â”œâ”€â”€ core/                           # COEIRO Operatorã‚³ã‚¢ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ say/
â”‚   â”‚   â”œâ”€â”€ *.test.ts              # å˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ integration.test.ts    # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ mcp-debug-enhanced.test.ts  # ğŸ†• mcp-debugçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ operator/                   # ğŸ”„ çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (2025å¹´8æœˆæ›´æ–°)
â”‚       â”œâ”€â”€ index.test.ts          # ğŸ†• OperatorManagerçµ±åˆãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ character-info-service.test.ts  # ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹
â”‚       â”œâ”€â”€ config-manager.test.ts # åŸºæœ¬è¨­å®šç®¡ç†
â”‚       â”œâ”€â”€ file-operation-manager.test.ts # æ±ç”¨KVã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ + ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
â”‚       â””â”€â”€ dynamic-config.test.ts # å‹•çš„è¨­å®šãƒ»VoiceProviderçµ±åˆ
â”œâ”€â”€ mcp/
â”‚   â””â”€â”€ server.test.ts             # MCPã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ mcp-debug/                     # MCPãƒ‡ãƒãƒƒã‚°ç’°å¢ƒãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ integration.test.ts    # Echo Backã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ jest-e2e.test.ts       # JSON-RPCå‡¦ç†ãƒ†ã‚¹ãƒˆ
â”‚       â”œâ”€â”€ cli-wrapper.test.ts    # ğŸ†• CLIãƒ©ãƒƒãƒ‘ãƒ¼ãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ coeiro-operator-e2e.test.ts # ğŸ†• ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ†ã‚¹ãƒˆ
â””â”€â”€ utils/
    â””â”€â”€ logger.test.ts             # ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
```

#### çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ†ã‚¹ãƒˆæ§‹æˆå¤‰æ›´ç‚¹
- **å‰Šé™¤ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆ**: 11ãƒ•ã‚¡ã‚¤ãƒ« â†’ 5ãƒ•ã‚¡ã‚¤ãƒ« (55%å‰Šæ¸›)
  - æ—§ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆã€é‡è¤‡ãƒ†ã‚¹ãƒˆã€çµ±åˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- **æ–°æ§‹æˆ**: ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«1:1å¯¾å¿œæ§‹æˆã§ç®¡ç†æ€§å‘ä¸Š
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: `index.test.ts` ã§OperatorManagerå…¨ä½“æ©Ÿèƒ½ã‚’ã‚«ãƒãƒ¼

## ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

### åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆåˆ†é›¢ã•ã‚ŒãŸä¸¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
npm run test:all

# COEIRO Operatorã®ã¿
npm run test:coeiro

# MCPãƒ‡ãƒãƒƒã‚°ç’°å¢ƒã®ã¿
npm run test:mcp-debug

# å¾“æ¥æ–¹å¼ï¼ˆå˜ä¸€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
npm test
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ

```bash
# åˆ†é›¢ã•ã‚ŒãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬
npm run test:projects:coverage

# COEIRO Operatorã®ã‚«ãƒãƒ¬ãƒƒã‚¸
npm run test:coeiro -- --coverage

# MCPãƒ‡ãƒãƒƒã‚°ç’°å¢ƒã®ã‚«ãƒãƒ¬ãƒƒã‚¸
npm run test:mcp-debug -- --coverage
```

### ç‰¹å®šãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# mcp-debugçµ±åˆæ©Ÿèƒ½ã‚’æ´»ç”¨ã—ãŸCOEIRO Operatorãƒ†ã‚¹ãƒˆ
npm run test:mcp-debug:enhanced

# å¾“æ¥ã®e2eãƒ†ã‚¹ãƒˆ
npm run test:e2e
```

## ğŸ†• mcp-debugçµ±åˆãƒ†ã‚¹ãƒˆã®ç‰¹å¾´

### COEIRO Operatorçµ±åˆãƒ†ã‚¹ãƒˆ (`mcp-debug-enhanced.test.ts`)

**æ–°æ©Ÿèƒ½**: å®Ÿéš›ã®COEIRO Operator MCPã‚µãƒ¼ãƒãƒ¼ã‚’mcp-debugã®çµ±åˆæ©Ÿèƒ½ã§åˆ¶å¾¡ã—ã¦ãƒ†ã‚¹ãƒˆ

```typescript
// ä½¿ç”¨ä¾‹
await testRunner.startCOEIROOperatorWithDebug(['--auto-reload']);
await testRunner.sendControlCommand('CTRL:target:restart');
```

**ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**:
- âœ… çµ±åˆãƒ‡ãƒãƒƒã‚°ç’°å¢ƒã§ã®èµ·å‹•ãƒ»åˆ¶å¾¡
- âœ… ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•ãƒ»ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- âœ… ã‚ªãƒšãƒ¬ãƒ¼ã‚¿æ©Ÿèƒ½ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- âœ… å‹•çš„å†èª­ã¿è¾¼ã¿æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
- âœ… ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

### MCPãƒ‡ãƒãƒƒã‚°ç’°å¢ƒãƒ†ã‚¹ãƒˆ

**å¯¾è±¡**: mcp-debugçµ±åˆç’°å¢ƒè‡ªä½“ã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

- **CLIãƒ©ãƒƒãƒ‘ãƒ¼ãƒ†ã‚¹ãƒˆ** (`cli-wrapper.test.ts`): `mcp-debug <target>.ts` ã®å‹•ä½œ
- **Echo Backã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚¹ãƒˆ** (`integration.test.ts`): JSON-RPCå‡¦ç†
- **å‡ºåŠ›ãƒãƒ£ãƒãƒ«åˆ†é›¢ãƒ†ã‚¹ãƒˆ** (`jest-e2e.test.ts`): MCP/Control/Debugåˆ†é›¢

## ğŸ“Š ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“

| ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ | å®Ÿè¡Œæ™‚é–“ç›®å®‰ | ç‰¹å¾´ |
|---|---|---|
| COEIRO Operator Core | 30-60ç§’ | å˜ä½“ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ |
| MCP Debug Enhanced | 60-120ç§’ | å®Ÿã‚µãƒ¼ãƒãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆ |
| MCP Debug Environment | 30-90ç§’ | ãƒ‡ãƒãƒƒã‚°ç’°å¢ƒè‡ªä½“ã®ãƒ†ã‚¹ãƒˆ |

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆé–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### COEIRO Operatorã®ãƒ†ã‚¹ãƒˆä½œæˆ

```typescript
// âŒ å¾“æ¥æ–¹å¼ï¼ˆç›´æ¥å®Ÿè¡Œï¼‰
const serverProcess = spawn('node', ['dist/mcp/server.js']);

// âœ… æ¨å¥¨æ–¹å¼ï¼ˆmcp-debugçµ±åˆï¼‰
const testRunner = new CoeirocoperatorMCPDebugTestRunner();
await testRunner.startCOEIROOperatorWithDebug(['--debug']);
```

### MCPãƒ‡ãƒãƒƒã‚°ç’°å¢ƒã®ãƒ†ã‚¹ãƒˆä½œæˆ

```typescript
// Echo Backã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ
const testRunner = new McpE2ETestRunner();
await testRunner.startEchoServer(true); // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**
   ```bash
   # ã‚ˆã‚Šé•·ã„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§å®Ÿè¡Œ
   npm run test:mcp-debug:enhanced -- --testTimeout=30000
   ```

2. **ãƒãƒ¼ãƒˆç«¶åˆ**
   ```bash
   # ãƒ†ã‚¹ãƒˆå‰ã«ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
   lsof -ti:50032 | xargs kill -9
   ```

3. **ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼**
   ```bash
   # ãƒ“ãƒ«ãƒ‰å¾Œã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   npm run build && npm run test:all
   ```

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

```bash
# è©³ç´°ãƒ­ã‚°ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
DEBUG=* npm run test:mcp-debug:enhanced

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿
npm test src/core/say/mcp-debug-enhanced.test.ts -- --verbose
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ãƒ†ã‚¹ãƒˆä¸¦åˆ—å®Ÿè¡Œ

```bash
# Jestä¸¦åˆ—å®Ÿè¡Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
npm run test:projects -- --maxWorkers=4

# é€æ¬¡å®Ÿè¡Œï¼ˆãƒ¡ãƒ¢ãƒªåˆ¶ç´„æ™‚ï¼‰
npm run test:projects -- --runInBand
```

### CI/CDè¨­å®š

```yaml
# GitHub Actionsä¾‹
- name: Run separated tests
  run: |
    npm run test:coeiro
    npm run test:mcp-debug
    npm run test:mcp-debug:enhanced
```

## ğŸ¯ ãƒ¡ãƒªãƒƒãƒˆ

### ãƒ†ã‚¹ãƒˆåˆ†é›¢ã«ã‚ˆã‚‹åˆ©ç‚¹

- ğŸš€ **é–‹ç™ºåŠ¹ç‡**: é–¢å¿ƒã®ã‚ã‚‹ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œå¯èƒ½
- ğŸ” **ãƒ‡ãƒãƒƒã‚°å®¹æ˜“æ€§**: å•é¡Œã®åˆ‡ã‚Šåˆ†ã‘ãŒç°¡å˜
- ğŸ“Š **ã‚«ãƒãƒ¬ãƒƒã‚¸ç²¾åº¦**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å“è³ªå¯è¦–åŒ–
- âš¡ **CIæœ€é©åŒ–**: ä¸¦åˆ—å®Ÿè¡Œã«ã‚ˆã‚‹æ™‚é–“çŸ­ç¸®

### mcp-debugçµ±åˆã®åˆ©ç‚¹

- ğŸ® **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ¶å¾¡**: å®Ÿã‚µãƒ¼ãƒãƒ¼ã®å‹•çš„æ“ä½œ
- ğŸ”„ **ãƒ©ã‚¤ãƒ–ãƒªãƒ­ãƒ¼ãƒ‰**: ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã®å³åº§åæ˜ 
- ğŸ“ˆ **è©³ç´°ç›£è¦–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ãƒ­ã‚°ã®çµ±åˆåé›†
- ğŸ›¡ï¸ **ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®åŒ…æ‹¬çš„æ¤œè¨¼

ã“ã®ãƒ†ã‚¹ãƒˆæ§‹æˆã«ã‚ˆã‚Šã€**COEIRO Operatorã®å“è³ªä¿è¨¼ã¨mcp-debugã®é–‹ç™ºåŠ¹ç‡**ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚